{% extends "base.html" %}
{% block title %}Disponibilidad Docente{% endblock %}
{% block content %}
<h1 class="h4 mb-3">Disponibilidad — {{ docente.usuario.get_full_name|default:docente.usuario.email }}</h1>

<div class="row g-3">
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header"><strong>Agregar franja semanal</strong></div>
      <div class="card-body">
        <form method="post">
          {% csrf_token %}
          <div class="row g-2">
            <div class="col-12 col-md-4">
              <label class="form-label">Día</label>
              {{ form_disp.dia_semana }}
            </div>
            <div class="col-6 col-md-4">
              <label class="form-label">Inicio</label>
              {{ form_disp.hora_inicio }}
            </div>
            <div class="col-6 col-md-4">
              <label class="form-label">Fin</label>
              {{ form_disp.hora_fin }}
            </div>
          </div>
          <button name="guardar_disp" class="btn btn-success mt-3">Agregar</button>
        </form>
      </div>
    </div>

    <div class="card shadow-sm mt-3">
      <div class="card-header"><strong>Franjas semanales</strong></div>
      <div class="table-responsive">
        <table class="table mb-0">
          <thead class="table-light">
            <tr><th>Día</th><th>Inicio</th><th>Fin</th><th class="text-end">Acciones</th></tr>
          </thead>
          <tbody>
            {% for d in disponibilidades %}
              <tr>
                <td>{{ d.get_dia_semana_display }}</td>
                <td>{{ d.hora_inicio|time:"H:i" }}</td>
                <td>{{ d.hora_fin|time:"H:i" }}</td>
                <td class="text-end">
                  <a href="{% url 'eliminar_disponibilidad' d.id %}" class="btn btn-sm btn-outline-danger">Eliminar</a>
                </td>
              </tr>
            {% empty %}
              <tr><td colspan="4" class="text-center text-muted py-3">Sin franjas.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header"><strong>Agregar excepción (bloqueo / extra)</strong></div>
      <div class="card-body">
        <form method="post">
          {% csrf_token %}
          <div class="row g-2">
            <div class="col-6">
              <label class="form-label">Fecha</label>
              {{ form_exc.fecha }}
            </div>
            <div class="col-3">
              <label class="form-label">Inicio</label>
              {{ form_exc.hora_inicio }}
            </div>
            <div class="col-3">
              <label class="form-label">Fin</label>
              {{ form_exc.hora_fin }}
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">Tipo</label>
              {{ form_exc.tipo }}
            </div>
            <div class="col-12 col-md-6">
              <label class="form-label">Motivo</label>
              {{ form_exc.motivo }}
            </div>
          </div>
          <button name="guardar_exc" class="btn btn-success mt-3">Agregar</button>
        </form>
      </div>
    </div>

    <div class="card shadow-sm mt-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <strong>Excepciones recientes</strong>
        <a href="{% url 'editar_perfil_docente' docente.usuario.id %}" class="btn btn-sm btn-outline-secondary">Volver a Perfil</a>
      </div>
      <div class="table-responsive">
        <table class="table mb-0">
          <thead class="table-light">
            <tr><th>Fecha</th><th>Inicio</th><th>Fin</th><th>Tipo</th><th class="text-end">Acciones</th></tr>
          </thead>
          <tbody>
            {% for e in excepciones %}
              <tr>
                <td>{{ e.fecha }}</td>
                <td>{{ e.hora_inicio|time:"H:i" }}</td>
                <td>{{ e.hora_fin|time:"H:i" }}</td>
                <td>
                  <span class="badge {% if e.tipo == 'BLOQUEO' %}bg-danger{% else %}bg-primary{% endif %}">
                    {{ e.get_tipo_display }}
                  </span>
                </td>

                <td class="text-end">
                  <a href="{% url 'eliminar_excepcion' e.id %}" class="btn btn-sm btn-outline-danger">Eliminar</a>
                </td>
              </tr>
            {% empty %}
              <tr><td colspan="5" class="text-center text-muted py-3">Sin excepciones.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
